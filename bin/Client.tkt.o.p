{"definition":{"name":"Client","version":"1.0","location":"https://github.com/thicket-lang/thicket-library-w3client","description":"W3 Client package","developers":[{"name":"D. Plaindoux","mail":"d.plaindoux@free.fr"}],"modules":["Boot.Client","Client.Dom","Client.Document","Client.Document.Renderer","Client.Event","Client.Event.Mouse","Client.Event.Key"],"native":{"javascript":["document.js"]},"requires":[{"Core":"1.0"}]},"content":{"Boot.Client.tkt.o":{"namespace":"Boot.Client","objcode":[],"main":[]},"Client.Dom.tkt.o":{"namespace":"Client.Dom","objcode":[[9,["dom",[["addEmptyAttribute",[[6,[[3,2],[5,"addAttribute"],[3,3],[4],[7,[[2,"Data.String.string"],[1,""],[4]]],[12]]],[14]]],["addOptionalAttribute",[[6,[[6,[[3,4],[5,"fold"],[3,2],[4],[7,[[3,2],[5,"addAttribute"],[3,3],[4]]],[12]]],[14]]],[14]]],["addChilds",[[6,[[3,3],[5,"foldL"],[6,[[3,4],[13,"addChild"]]],[4],[3,2],[12]]],[14]]],["onCondition",[[6,[[6,[[3,3],[5,"fold"],[7,[[3,4],[3,2],[4]]],[4],[3,2],[12]]],[14]]],[14]]],["map",[[6,[[3,3],[3,2],[12]]],[14]]]],[]]]],"main":[]},"Client.Document.tkt.o":{"namespace":"Client.Document","objcode":[[9,["documentElement",[["addAttribute",[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"dom.setAttribute"],[4]]],[4],[3,2],[12]]],["findAttribute",[[6,[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"dom.getAttribute"],[4]]],[4],[3,2],[4],[3,3],[4],[6,[[2,"Data.Option.some"],[7,[[2,"Data.String.string"],[3,4],[4]]],[12]]],[4],[7,[[2,"Data.Option.none"]]],[12]]],[14]]],["removeAttribute",[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"dom.resetAttribute"],[4]]],[4],[3,2],[12]]],["addChild",[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"dom.appendChild"],[4]]],[4],[3,2],[12]]],["removeChilds",[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"dom.removeChilds"],[4]]],[4],[3,2],[12]]],["onMouseEvent",[[6,[[6,[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"dom.onMouseEvent"],[4]]],[4],[3,2],[4],[2,"Client.Event.Mouse.mouseEventType"],[3,3],[4],[5,"toString"],[4],[6,[[3,4],[7,[[2,"Client.Document.documentElement"],[3,5],[4]]],[12]]],[12]]],[14]]],[14]]],["onKeyEvent",[[6,[[6,[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"dom.onKeyEvent"],[4]]],[4],[3,2],[4],[2,"Client.Event.Key.keyEventType"],[3,3],[4],[5,"toString"],[4],[6,[[6,[[3,4],[7,[[2,"Client.Document.documentElement"],[3,5],[4]]],[4],[7,[[2,"Data.Number.number"],[3,6],[4]]],[12]]],[14]]],[12]]],[14]]],[14]]],["find",[[6,[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"dom.elementById"],[4]]],[4],[3,2],[4],[3,3],[4],[6,[[2,"Data.Option.some"],[7,[[2,"Client.Document.documentElement"],[3,4],[4]]],[12]]],[4],[7,[[2,"Data.Option.none"]]],[12]]],[14]]],["clone",[[2,"Client.Document.documentElement"],[7,[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"dom.clone"],[4]]],[4],[3,2],[4]]],[12]]],["replaceWith",[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"dom.replace"],[4]]],[4],[3,2],[12]]],["remove",[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"dom.remove"],[4]]],[4],[3,2],[12]]],["value",[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"dom.getValue"],[4]]],[4],[3,2],[4],[6,[[2,"Data.Option.some"],[7,[[2,"Data.String.string"],[3,3],[4]]],[12]]],[4],[7,[[2,"Data.Option.none"]]],[12]]]],["Client.Dom.dom"]]],[9,["document",[["create",[[2,"Client.Document.documentElement"],[7,[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"document.createElement"],[4]]],[4],[3,1],[4]]],[12]]],["find",[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"document.elementById"],[4]]],[4],[3,1],[4],[6,[[2,"Data.Option.some"],[7,[[2,"Client.Document.documentElement"],[3,3],[4]]],[12]]],[4],[7,[[2,"Data.Option.none"]]],[12]]]],[]]],[10,["dom2domlist",[[6,[[2,"Data.List.List"],[5,"["],[3,1],[4],[13,"]"]]]]]],[10,["string2dom",[[6,[[2,"Client.Document.documentElement"],[7,[[2,"System.Internal.internal"],[7,[[2,"Data.String.string"],[1,"string.toDom"],[4]]],[4],[3,1],[4]]],[12]]]]]],[10,["string2domlist",[[6,[[2,"Data.List.List"],[5,"["],[7,[[2,"Client.Document.string2dom"],[3,1],[4]]],[4],[13,"]"]]]]]],[10,["number2dom",[[6,[[2,"Client.Document.string2dom"],[7,[[2,"Data.Number.number2string"],[3,1],[4]]],[12]]]]]],[10,["number2domlist",[[6,[[2,"Data.List.List"],[5,"["],[7,[[2,"Client.Document.number2dom"],[3,1],[4]]],[4],[13,"]"]]]]]]],"main":[]},"Client.Document.Renderer.tkt.o":{"namespace":"Client.Document.Renderer","objcode":[[8,["Renderer",[["<?",[[3,1],[14]]],["<~",[[3,2],[14]]]]]],[10,["domRenderer",[[6,[[2,"Client.Document.Renderer.Renderer"],[6,[[3,2],[5,"fold"],[7,[[2,"Client.Document.Renderer.documentRenderer"]]],[4],[2,"Client.Document.Renderer.documentRenderer"],[5,"<~"],[12]]],[4],[6,[[2,"Lang.Do.do"],[7,[[3,2],[5,"findAttribute"],[7,[[2,"Data.String.string"],[1,"id"],[4]]],[4],[5,"flatmap"],[6,[[3,1],[5,"find"],[3,3],[4],[5,"map"],[6,[[3,4],[5,"replaceWith"],[3,2],[12]]],[12]]],[4]]],[4],[5,"return"],[7,[[2,"Client.Document.Renderer.documentRenderer"]]],[12]]],[12]]]]]],[10,["documentRenderer",[[2,"Client.Document.Renderer.Renderer"],[6,[[3,1],[5,"fold"],[7,[[2,"Client.Document.Renderer.documentRenderer"]]],[4],[2,"Client.Document.Renderer.documentRenderer"],[5,"<~"],[12]]],[4],[6,[[2,"Lang.Do.do"],[7,[[3,1],[5,"findAttribute"],[7,[[2,"Data.String.string"],[1,"id"],[4]]],[4],[5,"flatmap"],[6,[[2,"Client.Document.document"],[3,2],[4],[5,"find"],[5,"map"],[6,[[3,3],[5,"replaceWith"],[3,1],[12]]],[12]]],[4]]],[4],[5,"return"],[7,[[2,"Client.Document.Renderer.documentRenderer"]]],[12]]],[4]]]]],"main":[]},"Client.Event.tkt.o":{"namespace":"Client.Event","objcode":[[8,["EventTrigger",[["install",[[3,1],[14]]]]]]],"main":[]},"Client.Event.Mouse.tkt.o":{"namespace":"Client.Event.Mouse","objcode":[[8,["MouseOver",[]]],[8,["MouseOut",[]]],[8,["MouseDown",[]]],[8,["MouseUp",[]]],[8,["MouseClick",[]]],[8,["MouseDblClick",[]]],[8,["ContextMenu",[]]],[8,["MouseEventType",[]]],[9,["mouseEventType",[["MouseOver.toString",[[2,"Data.String.string"],[1,"mouseover"],[12]]],["MouseOut.toString",[[2,"Data.String.string"],[1,"mouseout"],[12]]],["MouseDown.toString",[[2,"Data.String.string"],[1,"mousedown"],[12]]],["MouseUp.toString",[[2,"Data.String.string"],[1,"mousesup"],[12]]],["MouseClick.toString",[[2,"Data.String.string"],[1,"click"],[12]]],["MouseDblClick.toString",[[2,"Data.String.string"],[1,"dblclick"],[12]]],["ContextMenu.toString",[[2,"Data.String.string"],[1,"contextmenu"],[12]]]],[]]]],"main":[]},"Client.Event.Key.tkt.o":{"namespace":"Client.Event.Key","objcode":[[8,["KeyPress",[]]],[8,["KeyDown",[]]],[8,["KeyUp",[]]],[8,["KeyEventType",[]]],[9,["keyEventType",[["KeyPress.toString",[[2,"Data.String.string"],[1,"keypress"],[12]]],["KeyDown.toString",[[2,"Data.String.string"],[1,"keydown"],[12]]],["KeyUp.toString",[[2,"Data.String.string"],[1,"keypup"],[12]]]],[]]],[8,["Keys",[["CARRIAGE_RETURN",[[3,1],[14]]]]]],[10,["keys",[[2,"Client.Event.Key.Keys"],[7,[[2,"Data.Number.number"],[1,13],[4]]],[4]]]]],"main":[]},"document.js":"LyogZ2xvYmFsIGRvY3VtZW50Ki8KCi8qCiAqIFRoaWNrZXQKICogaHR0cHM6Ly9naXRodWIuY29tL2QtcGxhaW5kb3V4L3RoaWNrZXQKICoKICogQ29weXJpZ2h0IChjKSAyMDE1LTIwMTYgRGlkaWVyIFBsYWluZG91eAogKiBMaWNlbnNlZCB1bmRlciB0aGUgTEdQTDIgbGljZW5zZS4KICovCgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHJ1bnRpbWUpIHsKICAgIAogICAgJ3VzZSBzdHJpY3QnOwoKICAgIHZhciAkaSA9IHJ1bnRpbWUuaW5zdHJ1Y3Rpb247IAoKICAgIHJ1bnRpbWUubmF0aXZlKCJzdHJpbmcudG9Eb20iLCAxLCBmdW5jdGlvbihlbnYpIHsKICAgICAgICB2YXIgbmFtZSA9IHJ1bnRpbWUuY29uc3RhbnQoZW52LnBvcCgpKTsKICAgICAgICAKICAgICAgICByZXR1cm4gW1sgJGkuQ09OU1QsIGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG5hbWUpIF1dOwogICAgfSk7CgogICAgcnVudGltZS5uYXRpdmUoImRvY3VtZW50LmVsZW1lbnRCeUlkIiwgMywgZnVuY3Rpb24oZW52KXsKICAgICAgICB2YXIgbmFtZSA9IHJ1bnRpbWUuY29uc3RhbnQoZW52LnBvcCgpKSwKICAgICAgICAgICAgYVNvbWUgPSBlbnYucG9wKCksCiAgICAgICAgICAgIGFOb25lID0gZW52LnBvcCgpLCAgCiAgICAgICAgICAgIC8vIENvbXB1dGVkIHZhbHVlCiAgICAgICAgICAgIG5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChuYW1lKTsKICAgICAgICAKICAgICAgICBpZiAobm9kZSkgewogICAgICAgICAgICByZXR1cm4gW1sgJGkuUkVTVUxULCBhU29tZSBdLCBbICRpLkNPTlNULCBub2RlIF0sIFsgJGkuQVBQTFkgXV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIFtbICRpLlJFU1VMVCwgYU5vbmUgXV07CiAgICAgICAgfQogICAgfSk7CiAgICAKICAgIHJ1bnRpbWUubmF0aXZlKCJkb2N1bWVudC5jcmVhdGVFbGVtZW50IiwgMSwgZnVuY3Rpb24oZW52KXsKICAgICAgICB2YXIgbmFtZSA9IHJ1bnRpbWUuY29uc3RhbnQoZW52LnBvcCgpKTsKCiAgICAgICAgcmV0dXJuIFtbICRpLkNPTlNULCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG5hbWUpIF1dOwogICAgfSk7CgogICAgcnVudGltZS5uYXRpdmUoImRvbS5lbGVtZW50QnlJZCIsIDMsIGZ1bmN0aW9uKGVudil7CiAgICAgICAgdmFyIHNlbGYgPSBydW50aW1lLmNvbnN0YW50KGVudi5wb3AoKSksCiAgICAgICAgICAgIG5hbWUgPSBydW50aW1lLmNvbnN0YW50KGVudi5wb3AoKSksICAgICAgICAgICAgCiAgICAgICAgICAgIGFTb21lID0gZW52LnBvcCgpLAogICAgICAgICAgICBhTm9uZSA9IGVudi5wb3AoKSwgIAogICAgICAgICAgICAvLyBDb21wdXRlZCB2YWx1ZQogICAgICAgICAgICBub2RlID0gc2VsZi5nZXRFbGVtZW50QnlJZChuYW1lKTsKICAgICAgICAgICAgCiAgICAgICAgCiAgICAgICAgaWYgKG5vZGUpIHsKICAgICAgICAgICAgcmV0dXJuIFtbICRpLlJFU1VMVCwgYVNvbWUgXSwgWyAkaS5DT05TVCwgbm9kZSBdLCBbICRpLkFQUExZIF1dOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBbWyAkaS5SRVNVTFQsIGFOb25lIF1dOwogICAgICAgIH0KICAgIH0pOwogICAgCiAgICBydW50aW1lLm5hdGl2ZSgiZG9tLnNldEF0dHJpYnV0ZSIsIDMsIGZ1bmN0aW9uKGVudil7CiAgICAgICAgdmFyIHNlbGYgPSBlbnYucG9wKCksCiAgICAgICAgICAgIG5hbWUgPSBydW50aW1lLmNvbnN0YW50KGVudi5wb3AoKSksCiAgICAgICAgICAgIHZhbHVlID0gcnVudGltZS5jb25zdGFudChlbnYucG9wKCkpLAogICAgICAgICAgICAvLyBDb21wdXRlZCB2YWx1ZQogICAgICAgICAgICBub2RlID0gcnVudGltZS5jb25zdGFudChzZWxmKTsKCiAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpOwogICAgICAgIAogICAgICAgIHJldHVybiBbWyAkaS5SRVNVTFQsIHNlbGYgXV07CiAgICB9KTsKCiAgICBydW50aW1lLm5hdGl2ZSgiZG9tLmdldEF0dHJpYnV0ZSIsIDQsIGZ1bmN0aW9uKGVudil7CiAgICAgICAgdmFyIHNlbGYgPSBlbnYucG9wKCksCiAgICAgICAgICAgIG5hbWUgPSBydW50aW1lLmNvbnN0YW50KGVudi5wb3AoKSksCiAgICAgICAgICAgIGFTb21lID0gZW52LnBvcCgpLAogICAgICAgICAgICBhTm9uZSA9IGVudi5wb3AoKSwgICAgICAgICAgCiAgICAgICAgICAgIC8vIENvbXB1dGVkIHZhbHVlCiAgICAgICAgICAgIG5vZGUgPSBydW50aW1lLmNvbnN0YW50KHNlbGYpLAogICAgICAgICAgICB2YWx1ZSA9IG5vZGUuZ2V0QXR0cmlidXRlKG5hbWUpOwogICAgICAgIAogICAgICAgIGlmIChub2RlKSB7CiAgICAgICAgICAgIHJldHVybiBbWyAkaS5SRVNVTFQsIGFTb21lIF0sIFsgJGkuQ09OU1QsIHZhbHVlXSwgWyAkaS5BUFBMWSBdXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gW1sgJGkuUkVTVUxULCBhTm9uZSBdXTsKICAgICAgICB9CiAgICB9KTsKCiAgICBydW50aW1lLm5hdGl2ZSgiZG9tLnJlc2V0QXR0cmlidXRlIiwgMiwgZnVuY3Rpb24oZW52KXsKICAgICAgICB2YXIgc2VsZiA9IGVudi5wb3AoKSwKICAgICAgICAgICAgbmFtZSA9IHJ1bnRpbWUuY29uc3RhbnQoZW52LnBvcCgpKSwKICAgICAgICAgICAgLy8gQ29tcHV0ZWQgdmFsdWUKICAgICAgICAgICAgbm9kZSA9IHJ1bnRpbWUuY29uc3RhbnQoc2VsZik7CgogICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKG5hbWUpOwogICAgICAgIAogICAgICAgIHJldHVybiBbWyAkaS5SRVNVTFQsIHNlbGYgXV07CiAgICB9KTsKCiAgICBydW50aW1lLm5hdGl2ZSgiZG9tLmdldFZhbHVlIiwgMywgZnVuY3Rpb24oZW52KXsKICAgICAgICB2YXIgbm9kZSA9IHJ1bnRpbWUuY29uc3RhbnQoZW52LnBvcCgpKSwKICAgICAgICAgICAgYVNvbWUgPSBlbnYucG9wKCksCiAgICAgICAgICAgIGFOb25lID0gZW52LnBvcCgpOwoKICAgICAgICBpZiAobm9kZS52YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gW1sgJGkuUkVTVUxULCBhU29tZSBdLCBbICRpLkNPTlNULCBub2RlLnZhbHVlIF0sIFsgJGkuQVBQTFkgXV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIFtbICRpLlJFU1VMVCwgYU5vbmUgXV07CiAgICAgICAgfQogICAgfSk7CgogICAgcnVudGltZS5uYXRpdmUoImRvbS5vbk1vdXNlRXZlbnQiLCAzLCBmdW5jdGlvbihlbnYpewogICAgICAgIHZhciBzZWxmID0gZW52LnBvcCgpLAogICAgICAgICAgICBldmVudCA9IHJ1bnRpbWUuY29uc3RhbnQoZW52LnBvcCgpKSwKICAgICAgICAgICAgdmFsdWUgPSBlbnYucG9wKCksCiAgICAgICAgICAgIC8vIENvbXB1dGVkIHZhbHVlCiAgICAgICAgICAgIG5vZGUgPSBydW50aW1lLmNvbnN0YW50KHNlbGYpOwogICAgICAgIAogICAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gcnVudGltZS5leGVjdXRlKFtbICRpLlJFU1VMVCwgdmFsdWUgXSwgWyAkaS5DT05TVCwgbm9kZSBdLCBbICRpLkFQUExZIF1dKTsKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICByZXR1cm4gW1sgJGkuUkVTVUxULCBzZWxmIF1dOwogICAgfSk7ICAgIAogICAgCiAgICBydW50aW1lLm5hdGl2ZSgiZG9tLm9uS2V5RXZlbnQiLCAzLCBmdW5jdGlvbihlbnYpewogICAgICAgIHZhciBzZWxmID0gZW52LnBvcCgpLAogICAgICAgICAgICBldmVudCA9IHJ1bnRpbWUuY29uc3RhbnQoZW52LnBvcCgpKSwKICAgICAgICAgICAgdmFsdWUgPSBlbnYucG9wKCksCiAgICAgICAgICAgIC8vIENvbXB1dGVkIHZhbHVlCiAgICAgICAgICAgIG5vZGUgPSBydW50aW1lLmNvbnN0YW50KHNlbGYpOwogICAgICAgIAogICAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgZnVuY3Rpb24gKGV2dCkgeyAgICAgICAgICAgIAogICAgICAgICAgICB2YXIga2V5Q29kZSA9IGV2dC5rZXlDb2RlOwogICAgICAgICAgICByZXR1cm4gcnVudGltZS5leGVjdXRlKFtbICRpLlJFU1VMVCwgdmFsdWUgXSwgWyAkaS5DT05TVCwgbm9kZSBdLCBbICRpLkFQUExZIF0sIFsgJGkuQ09OU1QsIGtleUNvZGUgXSwgWyAkaS5BUFBMWSBdXSk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIFtbICRpLlJFU1VMVCwgc2VsZiBdXTsKICAgIH0pOyAgICAKICAgIAogICAgcnVudGltZS5uYXRpdmUoImRvbS5hcHBlbmRDaGlsZCIsIDIsIGZ1bmN0aW9uKGVudil7CiAgICAgICAgZnVuY3Rpb24gYWRkQ2hpbGQobm9kZSwgY2hpbGQpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gcnVudGltZS5jb25zdGFudChjaGlsZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAocnVudGltZS5nZXRUeXBlKHZhbHVlKSA9PT0gJ0FycmF5JykgewogICAgICAgICAgICAgICAgdmFsdWUuZm9yRWFjaChmdW5jdGlvbihjaGlsZCkgewogICAgICAgICAgICAgICAgICAgIGFkZENoaWxkKG5vZGUsIGNoaWxkKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbm9kZS5hcHBlbmRDaGlsZCh2YWx1ZSk7CiAgICAgICAgICAgIH0gICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgdmFyIHNlbGYgPSBlbnYucG9wKCksCiAgICAgICAgICAgIGNoaWxkID0gZW52LnBvcCgpLAogICAgICAgICAgICAvLyBDb21wdXRlZCB2YWx1ZQogICAgICAgICAgICBub2RlID0gcnVudGltZS5jb25zdGFudChzZWxmKTsKCiAgICAgICAgYWRkQ2hpbGQobm9kZSwgY2hpbGQpOwoKICAgICAgICByZXR1cm4gW1sgJGkuUkVTVUxULCBzZWxmIF1dOwogICAgfSk7ICAgIAogICAgICAKICAgIHJ1bnRpbWUubmF0aXZlKCJkb20ucmVtb3ZlQ2hpbGRzIiwgMSwgZnVuY3Rpb24oZW52KXsKICAgICAgICB2YXIgc2VsZiA9IGVudi5wb3AoKSwKICAgICAgICAgICAgLy8gQ29tcHV0ZWQgdmFsdWUKICAgICAgICAgICAgbm9kZSA9IHJ1bnRpbWUuY29uc3RhbnQoc2VsZik7CiAgICAgICAgCiAgICAgICAgd2hpbGUgKG5vZGUuZmlyc3RDaGlsZCkgewogICAgICAgICAgICBub2RlLnJlbW92ZUNoaWxkKG5vZGUuZmlyc3RDaGlsZCk7CiAgICAgICAgfSAgCgogICAgICAgIHJldHVybiBbWyAkaS5SRVNVTFQsIHNlbGYgXV07CiAgICB9KTsKICAgICAgICAgICAgCiAgICBydW50aW1lLm5hdGl2ZSgiZG9tLmNsb25lIiwgMSwgZnVuY3Rpb24oZW52KXsKICAgICAgICB2YXIgbm9kZSA9IHJ1bnRpbWUuY29uc3RhbnQoZW52LnBvcCgpKTsKCiAgICAgICAgcmV0dXJuIFtbICAkaS5DT05TVCwgbm9kZS5jbG9uZU5vZGUodHJ1ZSkgXV07CiAgICB9KTsKCiAgICBydW50aW1lLm5hdGl2ZSgiZG9tLnJlbW92ZSIsIDEsIGZ1bmN0aW9uKGVudil7CiAgICAgICAgdmFyIHNlbGYgPSBlbnYucG9wKCksCiAgICAgICAgICAgIC8vIENvbXB1dGVkIHZhbHVlCiAgICAgICAgICAgIG5vZGUgPSBydW50aW1lLmNvbnN0YW50KHNlbGYpOwoKICAgICAgICBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7CiAgICAgICAgCiAgICAgICAgcmV0dXJuIFtbICRpLlJFU1VMVCwgc2VsZiBdXTsKICAgIH0pOwoKICAgIHJ1bnRpbWUubmF0aXZlKCJkb20ucmVwbGFjZSIsIDIsIGZ1bmN0aW9uKGVudil7CiAgICAgICAgdmFyIG5vZGUgPSBydW50aW1lLmNvbnN0YW50KGVudi5wb3AoKSksCiAgICAgICAgICAgIG5ld1NlbGYgPSBlbnYucG9wKCksCiAgICAgICAgICAgIC8vIENvbXB1dGVkIHZhbHVlCiAgICAgICAgICAgIG5ld05vZGUgPSBydW50aW1lLmNvbnN0YW50KG5ld1NlbGYpOwogICAgICAgIAogICAgICAgIGlmIChub2RlLnBhcmVudE5vZGUpIHsKICAgICAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChuZXdOb2RlLG5vZGUpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXR1cm4gW1sgJGkuUkVTVUxULCBuZXdTZWxmIF1dOwogICAgfSk7CiAgICAKfTsKIA=="}}